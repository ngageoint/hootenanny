#!/bin/bash
set -e

# This test requires Joshua, and its not feasible to install automatically with hoot right now.  So, this test remains off and just gets 
# checked manually from time to time.  German and Spanish Joshua translation services need to be enabled in the config and Tomcat 
# restarted to enable them for this test to pass.

INPUT_DIR=test-files/cmd/glacial/ToEnglishTranslationVisitorTest
#TODO: will eventually need a better input file that supports testing detection and multiple translation languages
INPUT_FILE=$INPUT_DIR/ToEnglishTranslationVisitorTest-in.osm
GOLD_FILE=$INPUT_DIR/ToEnglishTranslationVisitorTest-out.osm
OUTPUT_DIR=test-output/cmd/glacial/ToEnglishTranslationVisitorTest
OUTPUT_FILE=$OUTPUT_DIR/ToEnglishTranslationVisitorTest-out.osm

mkdir -p $OUTPUT_DIR

# These can change per installation but are likely to remain unchanged for the time being.
hoot languages --detectable
hoot languages --detectors
hoot languages --translatable
hoot languages --translators

hoot convert -D convert.ops="hoot::ToEnglishTranslationVisitor" -D language.translation.translator=hoot::HootServicesTranslatorClient -D language.translation.source.languages="de;es" -D language.tag.keys="name;alt_name" -D language.translation.perform.exhaustive.search.with.no.detection=false -D language.translation.detected.language.overrides.specified.source.languages=false $INPUT_FILE $OUTPUT_FILE

hoot diff $GOLD_FILE $OUTPUT_FILE
